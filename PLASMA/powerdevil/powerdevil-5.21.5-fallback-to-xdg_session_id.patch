diff '--color=auto' -r -U3 powerdevil-5.21.5.orig/daemon/powerdevilpolicyagent.cpp powerdevil-5.21.5/daemon/powerdevilpolicyagent.cpp
--- powerdevil-5.21.5.orig/daemon/powerdevilpolicyagent.cpp	2021-05-04 15:57:30.000000000 +0300
+++ powerdevil-5.21.5/daemon/powerdevilpolicyagent.cpp	2021-05-05 03:13:46.756326502 +0300
@@ -240,6 +240,15 @@
         session.waitForFinished();
 
         if (!session.isValid()) {
+            // Fallback to XDG_SESSION_ID
+            QString sessionId = QProcessEnvironment::systemEnvironment().value("XDG_SESSION_ID");
+            if (!sessionId.isEmpty()) {
+                session = m_managerIface.data()->asyncCall(QLatin1String("GetSession"), sessionId);
+                session.waitForFinished();
+            }
+        }
+
+        if (!session.isValid()) {
             qCDebug(POWERDEVIL) << "The session is not registered with systemd";
             m_sdAvailable = false;
             return;
